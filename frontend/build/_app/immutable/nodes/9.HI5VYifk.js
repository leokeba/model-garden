import"../chunks/DsnmJJEf.js";import{p as re,s as N,a as se,o as de,y as oe,f as m,h as ie,b as o,c as ne,l as W,t as at,e as r,i as t,$ as le,u as ve,n as G,r as a,g as s,d as h,z as ce,m as l,j as ft,k as gt}from"../chunks/Bl5r8RQ7.js";import{i as w}from"../chunks/CBxzvLcE.js";import{s as jt,e as Jt,i as Mt}from"../chunks/BbziM7gO.js";import{s as ue}from"../chunks/DSPgjxZW.js";import{b as me}from"../chunks/Clp5w-cw.js";import{s as pe,a as _e}from"../chunks/poG7VF2y.js";import{p as fe}from"../chunks/BbAq7VkJ.js";import{B as rt,a as ge,C as U}from"../chunks/DatEFAiE.js";var xe=m('<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-green-600 bg-green-100"><span class="w-2 h-2 bg-green-600 rounded-full mr-1.5 animate-pulse"></span> Live Updates</span>'),he=m('<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-yellow-600 bg-yellow-100"><span class="w-2 h-2 bg-yellow-600 rounded-full mr-1.5"></span> Reconnecting...</span>'),ye=m('<div class="flex items-center gap-2"><!> <span> </span></div>'),be=m('<div class="flex justify-center items-center h-64"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div></div>'),$e=m('<div class="text-center py-8"><p class="text-red-600 text-lg"> </p> <!></div>'),we=m('<div><dt class="text-sm font-medium text-gray-700">Completed</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div>'),ke=m('<div class="p-6"><h2 class="text-xl font-semibold text-gray-900 mb-4">Job Information</h2> <div class="grid grid-cols-2 gap-4"><div><dt class="text-sm font-medium text-gray-700">Job ID</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-700">Status</dt> <dd class="mt-1"><span> </span></dd></div> <div><dt class="text-sm font-medium text-gray-700">Model Name</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-700">Base Model</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-700">Dataset</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-700">Output Directory</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-700">Created</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <!></div></div>'),Se=m('<div class="grid grid-cols-2 gap-4 text-sm"><div><dt class="block text-gray-700">Current Step</dt> <dd class="font-semibold"> </dd></div> <div><dt class="block text-gray-700">Total Steps</dt> <dd class="font-semibold"> </dd></div></div>'),Pe=m('<div class="text-sm"><dt class="block text-gray-700">Current Epoch</dt> <dd class="font-semibold"> </dd></div>'),Te=m('<div class="p-6"><h2 class="text-xl font-semibold text-gray-900 mb-4">Training Progress</h2> <div class="space-y-4"><div><div class="flex justify-between text-sm text-gray-700 mb-1"><span>Progress</span> <span> </span></div> <div class="w-full bg-gray-200 rounded-full h-2"><div class="bg-primary-600 h-2 rounded-full transition-all duration-300"></div></div></div> <!> <!></div></div>'),We=m('<span class="text-xs text-gray-500">Live</span>'),Ce=m('<div class="mb-1"> </div>'),Le=m('<div class="p-6"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-semibold text-gray-900">Real-time Logs</h2> <!></div> <div class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-auto max-h-96 text-sm font-mono"></div></div>'),je=m('<div class="mb-1"> </div>'),Je=m('<div class="p-6"><h2 class="text-xl font-semibold text-gray-900 mb-4">Training Logs</h2> <div class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-auto max-h-96 text-sm font-mono"></div></div>'),Me=m('<div class="p-6"><h3 class="text-lg font-semibold text-gray-900 mb-4">Configuration</h3> <div class="space-y-3 text-sm"><div><dt class="block text-gray-700 font-medium">Learning Rate</dt> <dd> </dd></div> <div><dt class="block text-gray-700 font-medium">Epochs</dt> <dd> </dd></div> <div><dt class="block text-gray-700 font-medium">Batch Size</dt> <dd> </dd></div> <div><dt class="block text-gray-700 font-medium">LoRA Rank</dt> <dd> </dd></div> <div><dt class="block text-gray-700 font-medium">LoRA Alpha</dt> <dd> </dd></div></div></div>'),Re=m('<div class="p-6"><h3 class="text-lg font-semibold text-gray-900 mb-4">Actions</h3> <div class="space-y-2"><!> <!> <!></div></div>'),De=m('<div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 space-y-6"><!> <!> <!> <!></div> <div class="space-y-6"><!> <!></div></div>'),Ae=m('<div class="min-h-screen bg-gray-50"><div class="bg-white shadow"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center py-6"><div class="flex items-center"><!> <h1 class="text-3xl font-bold text-gray-900 ml-4">Training Job Details</h1></div> <!></div></div></div> <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!></div></div>');function Ge(Rt,Dt){re(Dt,!0);const At=()=>_e(fe,"$page",zt),[zt,Bt]=pe(),H=ve(()=>At().params.id);let e=N(null),dt=N(!0),V=N(""),L=null,st=null,K=N(0),xt=5,z=N(!1),B=N(se([])),Q=N(null);function Et(d){if(typeof window>"u")return"";const p=window.location.protocol==="https:"?"wss:":"ws:",i=window.location.host;return`${p}//${i}/ws/training/${d}`}async function ot(){if(t(H))try{h(dt,!0);const d=await ge.getTrainingJob(t(H));h(e,d,!0),h(V,"")}catch(d){h(V,d instanceof Error?d.message:"Failed to load training job",!0)}finally{h(dt,!1)}}function ht(){if(!(!t(H)||typeof window>"u")&&!(t(e)&&(t(e).status==="completed"||t(e).status==="failed"||t(e).status==="cancelled")))try{const d=Et(t(H));console.log(`Connecting to WebSocket: ${d}`),L=new WebSocket(d),L.onopen=()=>{console.log("WebSocket connected"),h(z,!0),h(K,0)},L.onmessage=p=>{try{const i=JSON.parse(p.data);console.log("WebSocket update:",i),i.type==="status"&&t(e)?(t(e).status=i.status,i.completed_at&&(t(e).completed_at=i.completed_at)):i.type==="progress"&&t(e)?(t(e).progress=i.progress,t(e).current_step=i.progress?.current_step,t(e).total_steps=i.progress?.total_steps,t(e).current_epoch=i.progress?.epoch):i.type==="log"?(h(B,[...t(B),`[${new Date().toLocaleTimeString()}] ${i.message}`],!0),t(B).length>100&&h(B,t(B).slice(-100),!0),setTimeout(()=>It(),10)):i.type==="error"&&t(e)&&(t(e).error_message=i.message,h(V,i.message,!0))}catch(i){console.error("Failed to parse WebSocket message:",i)}},L.onerror=p=>{console.error("WebSocket error:",p),h(z,!1)},L.onclose=p=>{console.log("WebSocket closed:",p.code,p.reason),h(z,!1),L=null,t(e)&&t(e).status==="running"&&t(K)<xt&&(ce(K),console.log(`Reconnecting... (attempt ${t(K)}/${xt})`),st=setTimeout(()=>{ht()},Math.min(1e3*Math.pow(2,t(K)),3e4)))}}catch(d){console.error("Failed to create WebSocket:",d),h(z,!1)}}function Ft(){st&&(clearTimeout(st),st=null),L&&(L.close(),L=null),h(z,!1)}function It(){t(Q)&&(t(Q).scrollTop=t(Q).scrollHeight)}function yt(d){switch(d){case"running":return"text-blue-600 bg-blue-100";case"completed":return"text-green-600 bg-green-100";case"failed":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}}function bt(d){return typeof d=="number"?Math.round(d*100):d&&typeof d.current_step=="number"&&typeof d.total_steps=="number"?d.total_steps===0?0:Math.round(d.current_step/d.total_steps*100):0}function $t(d){return new Date(d).toLocaleString()}de(async()=>{await ot(),t(e)&&(t(e).status==="running"||t(e).status==="queued")&&ht()}),oe(()=>{Ft()});var it=Ae();ie(d=>{W(()=>le.title=`Training Job ${t(H)??""} - Model Garden`)});var nt=r(it),wt=r(nt),kt=r(wt),lt=r(kt),Nt=r(lt);rt(Nt,{href:"/training",variant:"ghost",size:"sm",children:(d,p)=>{G();var i=at("â† Training Jobs");o(d,i)},$$slots:{default:!0}}),G(2),a(lt);var Ut=s(lt,2);{var qt=d=>{var p=ye(),i=r(p);{var vt=C=>{var Y=ft(),E=gt(Y);{var j=T=>{var R=xe();o(T,R)},F=T=>{var R=he();o(T,R)};w(E,T=>{t(z)?T(j):T(F,!1)})}o(C,Y)};w(i,C=>{t(e).status==="running"&&C(vt)})}var X=s(i,2),M=r(X,!0);a(X),a(p),W(C=>{jt(X,1,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C??""}`),l(M,t(e).status)},[()=>yt(t(e).status)]),o(d,p)};w(Ut,d=>{t(e)&&d(qt)})}a(kt),a(wt),a(nt);var St=s(nt,2),Ot=r(St);{var Gt=d=>{var p=be();o(d,p)},Ht=d=>{var p=ft(),i=gt(p);{var vt=M=>{U(M,{children:(C,Y)=>{var E=$e(),j=r(E),F=r(j,!0);a(j);var T=s(j,2);rt(T,{onclick:ot,variant:"primary",class:"mt-4",children:(R,ct)=>{G();var ut=at("Try Again");o(R,ut)},$$slots:{default:!0}}),a(E),W(()=>l(F,t(V))),o(C,E)},$$slots:{default:!0}})},X=M=>{var C=ft(),Y=gt(C);{var E=j=>{var F=De(),T=r(F),R=r(T);U(R,{children:(_,D)=>{var y=ke(),v=s(r(y),2),c=r(v),f=s(r(c),2),k=r(f,!0);a(f),a(c);var u=s(c,2),n=s(r(u),2),g=r(n),x=r(g,!0);a(g),a(n),a(u);var S=s(u,2),q=s(r(S),2),I=r(q,!0);a(q),a(S);var A=s(S,2),b=s(r(A),2),$=r(b,!0);a(b),a(A);var P=s(A,2),J=s(r(P),2),mt=r(J,!0);a(J),a(P);var O=s(P,2),Z=s(r(O),2),pt=r(Z,!0);a(Z),a(O);var _t=s(O,2),Ct=s(r(_t),2),Yt=r(Ct,!0);a(Ct),a(_t);var Zt=s(_t,2);{var te=tt=>{var et=we(),Lt=s(r(et),2),ee=r(Lt,!0);a(Lt),a(et),W(ae=>l(ee,ae),[()=>$t(t(e).completed_at)]),o(tt,et)};w(Zt,tt=>{t(e).completed_at&&tt(te)})}a(v),a(y),W((tt,et)=>{l(k,t(e).job_id||t(e).id),jt(g,1,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${tt??""}`),l(x,t(e).status),l(I,t(e).config?.name||t(e).name),l($,t(e).config?.base_model||t(e).base_model),l(mt,t(e).config?.dataset_path||t(e).dataset_path),l(pt,t(e).config?.output_dir||t(e).output_dir),l(Yt,et)},[()=>yt(t(e).status),()=>$t(t(e).created_at)]),o(_,y)},$$slots:{default:!0}});var ct=s(R,2);{var ut=_=>{U(_,{children:(D,y)=>{var v=Te(),c=s(r(v),2),f=r(c),k=r(f),u=s(r(k),2),n=r(u);a(u),a(k);var g=s(k,2),x=r(g);a(g),a(f);var S=s(f,2);{var q=b=>{var $=Se(),P=r($),J=s(r(P),2),mt=r(J,!0);a(J),a(P);var O=s(P,2),Z=s(r(O),2),pt=r(Z,!0);a(Z),a(O),a($),W(()=>{l(mt,t(e).current_step),l(pt,t(e).total_steps)}),o(b,$)};w(S,b=>{t(e).current_step&&t(e).total_steps&&b(q)})}var I=s(S,2);{var A=b=>{var $=Pe(),P=s(r($),2),J=r(P,!0);a(P),a($),W(()=>l(J,t(e).current_epoch)),o(b,$)};w(I,b=>{t(e).current_epoch&&b(A)})}a(c),a(v),W((b,$)=>{l(n,`${b??""}%`),ue(x,`width: ${$??""}%`)},[()=>bt(t(e).progress),()=>bt(t(e).progress)]),o(D,v)},$$slots:{default:!0}})};w(ct,_=>{t(e).status==="running"&&t(e).progress&&_(ut)})}var Pt=s(ct,2);{var Vt=_=>{U(_,{children:(D,y)=>{var v=Le(),c=r(v),f=s(r(c),2);{var k=n=>{var g=We();o(n,g)};w(f,n=>{t(z)&&n(k)})}a(c);var u=s(c,2);Jt(u,21,()=>t(B),Mt,(n,g)=>{var x=Ce(),S=r(x,!0);a(x),W(()=>l(S,t(g))),o(n,x)}),a(u),me(u,n=>h(Q,n),()=>t(Q)),a(v),o(D,v)},$$slots:{default:!0}})};w(Pt,_=>{(t(e).status==="running"||t(e).status==="queued")&&t(B).length>0&&_(Vt)})}var Kt=s(Pt,2);{var Qt=_=>{U(_,{children:(D,y)=>{var v=Je(),c=s(r(v),2);Jt(c,21,()=>t(e).logs,Mt,(f,k)=>{var u=je(),n=r(u,!0);a(u),W(()=>l(n,t(k))),o(f,u)}),a(c),a(v),o(D,v)},$$slots:{default:!0}})};w(Kt,_=>{t(e).logs&&t(e).logs.length>0&&_(Qt)})}a(T);var Tt=s(T,2),Wt=r(Tt);U(Wt,{children:(_,D)=>{var y=Me(),v=s(r(y),2),c=r(v),f=s(r(c),2),k=r(f,!0);a(f),a(c);var u=s(c,2),n=s(r(u),2),g=r(n,!0);a(n),a(u);var x=s(u,2),S=s(r(x),2),q=r(S,!0);a(S),a(x);var I=s(x,2),A=s(r(I),2),b=r(A,!0);a(A),a(I);var $=s(I,2),P=s(r($),2),J=r(P,!0);a(P),a($),a(v),a(y),W(()=>{l(k,t(e).config?.hyperparameters?.learning_rate||t(e).hyperparameters?.learning_rate),l(g,t(e).config?.hyperparameters?.num_epochs||t(e).hyperparameters?.num_epochs),l(q,t(e).config?.hyperparameters?.batch_size||t(e).hyperparameters?.batch_size),l(b,t(e).config?.lora_config?.r||t(e).lora_config?.r),l(J,t(e).config?.lora_config?.lora_alpha||t(e).lora_config?.lora_alpha)}),o(_,y)},$$slots:{default:!0}});var Xt=s(Wt,2);U(Xt,{children:(_,D)=>{var y=Re(),v=s(r(y),2),c=r(v);rt(c,{variant:"primary",fullWidth:!0,onclick:ot,children:(n,g)=>{G();var x=at("Refresh Status");o(n,x)},$$slots:{default:!0}});var f=s(c,2);{var k=n=>{rt(n,{get href(){return`/models/${t(e).config.name??""}`},variant:"secondary",fullWidth:!0,children:(g,x)=>{G();var S=at("View Model");o(g,S)},$$slots:{default:!0}})};w(f,n=>{t(e).status==="completed"&&t(e).config&&n(k)})}var u=s(f,2);rt(u,{href:"/training/new",variant:"secondary",fullWidth:!0,children:(n,g)=>{G();var x=at("Start New Job");o(n,x)},$$slots:{default:!0}}),a(v),a(y),o(_,y)},$$slots:{default:!0}}),a(Tt),a(F),o(j,F)};w(Y,j=>{t(e)&&j(E)},!0)}o(M,C)};w(i,M=>{t(V)?M(vt):M(X,!1)},!0)}o(d,p)};w(Ot,d=>{t(dt)?d(Gt):d(Ht,!1)})}a(St),a(it),o(Rt,it),ne(),Bt()}export{Ge as component};
